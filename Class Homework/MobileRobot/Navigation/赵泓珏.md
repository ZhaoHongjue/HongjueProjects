## 

## 文件说明

- `static_main_feedback.py`为基于反馈控制法实现的静态障碍物环境下的导航规划
- `dynamic_main_feedback.py`为基于反馈控制法实现的动态障碍物环境下的导航规划

## 任务分工

赵泓珏在此次作业中主要负责了Voronoi法、反馈控制法、PID轨迹跟踪的实现，并结合Voronoi法、人工势场法和反馈控制法给出了一种在静态障碍物的情况下性能较好的导航规划方案

## Voronoi图法

具体实现见`Voronoi.py`。所有相关功能集合到了类`VoronoiMap`中。实现效果如下所示。

<img src="https://zhj-0830.oss-cn-hangzhou.aliyuncs.com/img/image-20211206103012936.png" alt="image-20211206103012936" style="zoom: 33%;" />

整体来说，Voronoi图法得到的路径相对较短，路径规划得到的点也比较少。但问题在于，由于没有进行路径上的碰撞检测，此时机器人很容易与周围环境发生碰撞。

为了实现避障，在Voronoi图法得到路径的每两个点之间利用人工势场法进一步规划（具体见`PathGenerating.py`）。此时得到的路径如下所示：

<img src="https://zhj-0830.oss-cn-hangzhou.aliyuncs.com/img/image-20211206103617009.png" alt="image-20211206103617009" style="zoom:33%;" />

此时可以看出，在规划得出的路径上，机器人到周围障碍物的距离明显变大，运动更加安全。并且由于只在Voronoi图法得到路径的每两个点之间进行人工势场法规划，人工势场法规划的距离变短，较好地解决了在全局使用人工势场法时难以产生路径的问题。但由于人工势场法本身的局限性，此方法在障碍物较为密集的情况下仍然可能较难产生路径。

## PID路径跟踪

在规划得到路径后，我们希望机器人尽可能沿着预设路径前进。由此，采用PID算法实现控制也是一种比较朴素的思想。首先得出机器人在全局坐标系下的位姿误差$\bar{q} = q_r - q = [x_r - x,~y_r - y,~\theta_r - \theta]^T$，之后再变换到机器人的自身坐标系，此时可表示为$e_p = T_\epsilon\bar{q}$。此次作业中采用了位置式的数字PID控制，速度和角速度可以表示为：
$$
\begin{aligned}
v(k) = &K_{p1}x_e(k) + K_{i1} T\sum_{i=0}^kx_e(i) + \frac{K_{d1}}{T}(x_e(k) - x_e(k-1))\\
\omega(k) = &K_{p2}y_e(k) + K_{i2} T\sum_{i=0}^ky_e(i) + \frac{K_{d2}}{T}(y_e(k) - y_e(k-1))\\
&+K_{p3}\theta_e(k) + K_{i3} T\sum_{i=0}^k\theta_e(k) + \frac{K_{d3}}{T}(\theta_e(k) - \theta_e(k-1))
\end{aligned}
$$
这种方法可以实现路径跟踪，但是由于PID参数较难整定，机器人在运动过程中速度和角速度容易发生振荡，导致机器人的运动不稳定。

## 反馈控制法

反馈控制法的核心思想是根据机器人到目标点的距离、角度等关系产生控制律，此次作业中我们采用的是线性控制律。

首先，我们基于相关原理，实现了两点之间的反馈控制（具体见`feedback.move_to_pose`函数）。一种比较朴素的想法是：在路径规划得到路径的每两点之间直接使用反馈控制法，通过逐段使用反馈控制从而到达目标点。但是，这种思路的主要问题在于：由于逐段使用反馈控制，根据$v = k_\rho\rho$可知，机器人在中间点的速度会变为0，此时机器人的运动并不流畅，反而在每个中间点处都会发生卡顿。

为了解决以上的问题，我们采用了如下的解决方法：首先使得整个路径的包含的点尽可能地稠密（经过Voronoi+人工势场法后可以达到此效果），找出机器人到路径上的最近的点，然后选取路径上距离该点有一定距离的点作为反馈控制预期到达的目标点，使得每次反馈控制时预期到达的点都距离机器人有一定距离，避免了除终点外在运动过程中机器人速度变为0的情况，从而使得静态障碍物下得导航规划具有较好效果。具体实现可见`static_main_feedback.py`。

为了实现动态避障，必须实时得知地图信息，这里我们采用了一种比较简单粗暴的思路：机器人实时路径规划，并依据当前规划出的路径按照反馈控制法进行轨迹跟踪。但是此时如果速度调的很大，会出现不稳定的情况。由此，这里我们把速度调小，从而实现了较为稳定的效果。具体实现可见`dynamic_main_feedback.py`。在具体运行中出现的问题是：由于路径实时变化，虽然速度调小，但仍然会出现不稳定的情况，并且由于机器人速度较慢，很多时候无法及时避障。

